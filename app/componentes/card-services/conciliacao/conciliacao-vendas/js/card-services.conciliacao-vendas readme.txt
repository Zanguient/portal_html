# README #

Módulo que:
 - gerencia o layout da tela de consolidação de vendas da Conciliação (app/componentes/card-services/conciliação/conciliacao-vendas/index.html);
 

### Pra Que Serve Este Módulo? ###

Gerenciar completamente a tela de conciliação de vendas da Conciliação (Card Services).  



### O que é necessário para usar o módulo? ###

Como esse é um controller filho do controller principal "appCtrl" (app.js), ele herda todos os módulos importados por ele.
Além deles, é necessária a importação dos seguintes módulos externos.

 |----------------------------------------|---------------------------------------------------|-------------------------------------------|
 |                MODULO                  |                   DESCRIÇÃO                       |         IMPORT (no app/index.html)        |
 |----------------------------------------|---------------------------------------------------|-------------------------------------------|
 |                       
 |----------------------------------------|---------------------------------------------------|-------------------------------------------|


 
### Outras depêndencias ###

  * Evento "mudancaDeRota", proveniente do "appCtrl", para de fato modificar a rota/estado
  * $scope.token do "appCtrl"
  * Emite evento "acessouTela" no init do controller para que seja feito o log de acesso de tela
  * Evento "acessoDeTelaNotificado", proveniente do "appCtrl", para de fato exibir a tela e fazer requisições 
	=> importante para o log correto de requisições HTTP, ao qual identifica corretamente a (tela de) origem
  * $scope.grupoempresa, do "appCtrl" : grupo empresa informado pelo usuário na barra administrativa
  * Evento "alterouGrupoEmpresa", emitido pelo controller "appCtrl", para identificar a mudança do $scope.grupoempresa
  * APIS:
    - cliente/empresa
    - card/tbadquirente
    - card/conciliacaovendas
    - card/correcaovendaerp
	
 
 
 ### Interação com a WEB API ###
 
  * cliente/empresa
    - GET : listagem das filiais (coleção 0)
			[
			  { nu_cnpj : string,
				ds_fantasia : string,
				filial : string ou null,
				id_grupo : int
			  }
			]
 
  * card/tbadquirente : listagem das adquirentes
	- GET : listagem das adquirentes (coleção 1)
			[
			  { cdAdquirente : int,
                nmAdquirente : string,
                dsAdquirente : string,
                stAdquirente : int,  // igual a 1
				hrExecucao : datetime,
			  }
			]
 
  * card/conciliacaovendas
    - GET : obtém as informações para conciliação de vendas (coleção 0)
	  [
		{ Venda : {  Id : int,
			     Nsu : string,
			     Valor : double,
			     Sacado : string ou null, (null se não informado na importação)
			     Bandeira : string,
			     Data : datetime,
			     Filial : string,
                             Parcelas : int,
			     Adquirente : string, 
			  }, 
		  Recebimento :  null ou // se null => não tem info do lado da adquirente
				 {  Id : int,
				    Nsu : string,
				    CodResumoVendas : string,
				    Valor : double,
				    Sacado : string ou null, (null se bandeira não mapeado para sacado do cliente)
			            Bandeira : string,
				    Data : datetime,
				    Filial : string,
				    Parcelas : int,	
				    Adquirente : string, 
				 },
		  
		  Conciliado : int, // 1 : CONCILIADO | 2 : PRÉ-CONCILIADO | 3 : NÃO-CONCILIADO | 4 : CONCILIADO COM DIVERGÊNCIA
		}
	  ]

    - GET : busca títulos prováveis para o recebível (coleção 1)
	  [
		{ Id : int,
		  Parcelas: int,
		  Nsu : string,
		  Valor : double,
		  Bandeira : string,
		  Data : datetime,
		  Adquirente : string, 
		  Filial : string,
		  Tipo : 'V', // venda
		}
	  ]
	  OBS: enviar como filtro IDRECEBIMENTO e NUMPARCELA

	
	  
  
    - PUT : seta os itens recebimento para apontar para determinada venda ou desassociar de uma venda
			[{ idRecebimentoVenda : int, // set -1 para desassociar de uma venda
			   idRecebimento: int
			 }]
			
    - POST : Faz a conciliação TEF
			{ 
			    data : string,
			    nrCNPJ : string,
			    cdAdquirente : int
			}	



   * card/correcaovendaerp
    - PUT : envia os idsRecebimentos que estão conciliados com as vendas a serem corrigidas no ERP do cliente
           { idsRecebimento : [int] } ou { data: string, // obrigatório
				           nrCNPJ : string, // não obrigatório
				           cdAdquirente: int, // obrigatório
				         }
	
	
	
 
   

   
### Desenvolvedores ###

Deivid Marinho - deividgfmarinho@gmail.com